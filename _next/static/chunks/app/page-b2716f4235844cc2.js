(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7207:function(e,t,a){Promise.resolve().then(a.bind(a,2087))},2087:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return T}});var i=a(7437),s=a(2265);function l(e){let t=0,a=0;for(;0===t;)t=e();for(;0===a;)a=e();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*a)}function r(e){var t,a,i;let{S0:s,regime:r,days:n,seed:d=11,randomize:h=!0,driftNoise:u=.02,volOfVol:c=.1,meanRevert:o=.2,jumps:x}=e,p=(i=0|d,function(){let e=i+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}),m=[s],g=[],y=[],j=r.baseMu,b=r.baseSigma,f=(null==x?void 0:x.enabled)&&x.lambda||0,v=null!==(t=null==x?void 0:x.muJ)&&void 0!==t?t:-.2,M=null!==(a=null==x?void 0:x.sigmaJ)&&void 0!==a?a:.25,k=Math.exp(v+.5*M*M)-1;for(let e=1;e<=n;e++){if(h){let e=l(p)*u;j=r.baseMu+.9*(j-r.baseMu)+e;let t=l(p)*c*b;b=Math.max(.05,b+o*(r.baseSigma-b)+t)}else j=r.baseMu,b=r.baseSigma;let t=1/252,a=1/252*(j-.5*b*b-f*k)+b*Math.sqrt(1/252)*l(p);if(f>0){let e=f*t;p()<e&&(a+=v+M*l(p))}let i=m[e-1]*Math.exp(a);m.push(i),g.push(j),y.push(b)}let L=new Date;return{dates:m.map((e,t)=>{let a=new Date(L);return a.setDate(L.getDate()+t),a.toISOString().slice(0,10)}),prices:m,muSeries:g,sigmaSeries:y}}let n={BULL:{key:"BULL",label:"Bullish",baseMu:.08,baseSigma:.2},NEUTRAL:{key:"NEUTRAL",label:"Neutral",baseMu:0,baseSigma:.2},BEAR:{key:"BEAR",label:"Bearish",baseMu:-.08,baseSigma:.25},VOLATILE:{key:"VOLATILE",label:"Volatile",baseMu:0,baseSigma:.4},CUSTOM:{key:"CUSTOM",label:"Custom",baseMu:.05,baseSigma:.25}},d=e=>{let t=Math.abs(e),a=1/(1+.3275911*t);return(e<0?-1:1)*(1-((((1.061405429*a+-1.453152027)*a+1.421413741)*a+-.284496736)*a+.254829592)*a*Math.exp(-t*t))},h=e=>.5*(1+d(e/Math.SQRT2)),u=e=>Math.exp(-.5*e*e)/Math.sqrt(2*Math.PI);function c(e,t,a,i,s,l,r){if(s<=0||l<=0)return"CALL"===r?Math.max(0,e-t):Math.max(0,t-e);let n=Math.sqrt(l),d=(Math.log(e/t)+(a-i+.5*s*s)*l)/(s*n),u=d-s*n,c=Math.exp(-i*l),o=Math.exp(-a*l);return"CALL"===r?e*c*h(d)-t*o*h(u):t*o*h(-u)-e*c*h(-d)}function o(e,t,a,i,s,l,r){let n=Math.sqrt(Math.max(1e-8,l)),d=(Math.log(e/t)+(a-i+.5*s*s)*l)/(s*n),c=d-s*n,o=Math.exp(-i*l),x=Math.exp(-a*l),p="CALL"===r?o*h(d):-o*h(-d),m=o*u(d)/(e*s*n),g=e*o*u(d)*n,y=-(e*o*u(d)*s)/(2*n)-a*t*x*h(c)+i*e*o*h(d),j=-(e*o*u(d)*s)/(2*n)+a*t*x*h(-c)-i*e*o*h(-d);return{delta:p,gamma:m,vega:g,theta:"CALL"===r?y:j}}function x(){return{legs:[],realized:0}}let p=e=>"LONG"===e?1:-1;function m(e,t,a,i){return c(a,e.strike,t.r,t.q,t.sigma,Math.max(0,i),e.right)}function g(e,t,a,i){return p(i.side)*i.quantity*m(i,e,t,a)}function y(e,t,a,i){if(0===e.legs.length)return e;let s=i.prices[a],l=Math.max(0,(e.expiryIndex-a)/365),r=e.legs.reduce((e,a)=>e+g(t,s,l,a),0),n=e.legs.reduce((e,t)=>e+("LONG"===t.side?1:-1)*t.quantity*t.entryPrice,0);return{legs:[],entryIndex:void 0,expiryIndex:void 0,realized:e.realized+(r-n)}}function j(e,t,a,i){return i.reduce((i,s)=>i+("LONG"===s.side?1:-1)*s.quantity*c(t,s.strike,e.r,e.q,e.sigma,Math.max(0,a),s.right),0)}var b=a(7346),f=a(5211);function v(e){let{labels:t,datasets:a,height:s=120}=e,l=a.map(e=>({label:e.label,data:e.data,borderColor:e.color,pointRadius:0}));return(0,i.jsx)(b.x1,{data:{labels:t,datasets:l},options:{animation:!1,plugins:{legend:{display:!0}},scales:{x:{ticks:{maxTicksLimit:10}}}},height:s})}f.kL.register(f.jn,f.f$,f.od,f.uw,f.u,f.De),f.kL.register(f.jn,f.f$,f.od,f.uw,f.u,f.De);let M=["#60a5fa","#22c55e","#eab308","#f97316","#a78bfa","#14b8a6","#f43f5e"];function k(e){var t,a;let{series:s}=e,l=s.map((e,t)=>{var a;return{label:e.label,data:e.values,borderColor:null!==(a=e.color)&&void 0!==a?a:M[t%M.length],backgroundColor:"transparent",pointRadius:0,borderWidth:1.5}}),r=null!==(a=null===(t=s[0])||void 0===t?void 0:t.prices.map(e=>e.toFixed(2)))&&void 0!==a?a:[];return(0,i.jsx)(b.x1,{data:{labels:r,datasets:l},options:{animation:!1,plugins:{legend:{display:!0}},scales:{x:{ticks:{maxTicksLimit:10}}}},height:140})}function L(e){let{prices:t,payoff:a}=e,s={labels:t.map(e=>e.toFixed(2)),datasets:[{label:"P/L @ Expiry",data:a,borderColor:"#60a5fa",backgroundColor:"rgba(96,165,250,0.15)",fill:!0,pointRadius:0}]};return(0,i.jsx)(b.x1,{data:s,options:{animation:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{maxTicksLimit:10}}}},height:110})}function N(e){var t,a;let{env:l,currentIndex:r,position:n,onClose:d,onSubmit:h,hist:u,preset:o}=e,x=null!==(t=null==o?void 0:o.expiryDays)&&void 0!==t?t:n.expiryIndex?Math.max(1,n.expiryIndex-r):30,p=(null!==(a=null==o?void 0:o.legs)&&void 0!==a?a:[{side:"LONG",right:"CALL",quantity:1,strike:Math.round(u.prices[r])}]).map(e=>({id:crypto.randomUUID(),...e})),[g,b]=(0,s.useState)(x),[f,v]=(0,s.useState)(p),[M,k]=(0,s.useState)({});(0,s.useEffect)(()=>{o&&(b(o.expiryDays),v(o.legs.map(e=>({id:crypto.randomUUID(),...e}))))},[null==o?void 0:o.expiryDays,JSON.stringify((null==o?void 0:o.legs)||[])]);let N=u.prices[r],q=n.expiryIndex?Math.max(0,(n.expiryIndex-r)/365):Math.max(1,Math.round(g))/365,C=(0,s.useMemo)(()=>j(l,N,q,f),[l,N,q,f]),S=(0,s.useMemo)(()=>(function(e,t,a,i){let s=j(e,t,a,i),l=Math.max(.1,.7*t),r=1.3*t,n=[],d=[];for(let e=0;e<=200;e++){let t=l+e/200*(r-l),a=i.reduce((e,a)=>{let i="CALL"===a.right?Math.max(0,t-a.strike):Math.max(0,a.strike-t);return e+("LONG"===a.side?1:-1)*a.quantity*i},0);n.push(t),d.push(a+s)}return[n,d]})(l,N,q,f),[l,N,q,f]),I=(e,t)=>v(f.map(a=>a.id===e?{...a,...t}:a)),O=e=>v(f.filter(t=>t.id!==e));return(0,i.jsx)("div",{className:"modal",children:(0,i.jsxs)("div",{className:"modal-body",style:{maxWidth:900},children:[(0,i.jsxs)("h3",{children:["Take action (day ",r,")"]}),(0,i.jsx)("div",{className:"row wrap",children:(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"Expiry (days)"}),(0,i.jsx)("input",{type:"number",value:g,min:1,step:1,onChange:e=>b(parseInt(e.target.value||"1"))})]})}),n.legs.length>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h4",{children:"Existing legs — close partially"}),(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Side"}),(0,i.jsx)("th",{children:"Right"}),(0,i.jsx)("th",{children:"Qty"}),(0,i.jsx)("th",{children:"Strike"}),(0,i.jsx)("th",{children:"Now px"}),(0,i.jsx)("th",{children:"Close qty"})]})}),(0,i.jsx)("tbody",{children:n.legs.map(e=>{var t;let a=Math.max(0,(n.expiryIndex-r)/365),s=c(N,e.strike,l.r,l.q,l.sigma,a,e.right),d=Math.max(0,Math.min(e.quantity,null!==(t=M[e.id])&&void 0!==t?t:0));return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.side}),(0,i.jsx)("td",{children:e.right}),(0,i.jsx)("td",{children:e.quantity}),(0,i.jsx)("td",{children:e.strike}),(0,i.jsx)("td",{children:s.toFixed(2)}),(0,i.jsx)("td",{children:(0,i.jsx)("input",{type:"number",value:d,min:0,max:e.quantity,step:1,onChange:t=>k({...M,[e.id]:parseInt(t.target.value||"0",10)})})})]},e.id)})})]})]}),(0,i.jsxs)("h4",{children:["New legs (to add ",n.expiryIndex?"at same expiry":"as new position",")"]}),f.map(e=>(0,i.jsxs)("div",{className:"row leg",children:[(0,i.jsxs)("select",{value:e.side,onChange:t=>I(e.id,{side:t.target.value}),children:[(0,i.jsx)("option",{value:"LONG",children:"LONG"}),(0,i.jsx)("option",{value:"SHORT",children:"SHORT"})]}),(0,i.jsxs)("select",{value:e.right,onChange:t=>I(e.id,{right:t.target.value}),children:[(0,i.jsx)("option",{value:"CALL",children:"CALL"}),(0,i.jsx)("option",{value:"PUT",children:"PUT"})]}),(0,i.jsxs)("label",{className:"field small",children:[(0,i.jsx)("span",{children:"Qty"}),(0,i.jsx)("input",{type:"number",value:e.quantity,min:1,step:1,onChange:t=>I(e.id,{quantity:parseInt(t.target.value||"1",10)})})]}),(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"Strike"}),(0,i.jsx)("input",{type:"number",value:e.strike,step:.5,onChange:t=>I(e.id,{strike:parseFloat(t.target.value)})})]}),(0,i.jsxs)("span",{className:"muted",children:["Price: ",c(N,e.strike,l.r,l.q,l.sigma,q,e.right).toFixed(2)]}),(0,i.jsx)("button",{className:"danger",onClick:()=>O(e.id),children:"Remove"})]},e.id)),(0,i.jsx)("button",{onClick:()=>v([...f,{id:crypto.randomUUID(),side:"LONG",right:"CALL",quantity:1,strike:Math.round(N)}]),children:"+ Add leg"}),(0,i.jsxs)("div",{className:"panel",style:{marginTop:12},children:[(0,i.jsxs)("div",{className:"row wrap",children:[(0,i.jsx)("b",{children:"Order premium (credit + / debit −):"})," ",C.toFixed(2)]}),(0,i.jsx)("div",{children:(0,i.jsx)(L,{prices:S[0],payoff:S[1]})})]}),(0,i.jsxs)("div",{className:"row",style:{justifyContent:"flex-end"},children:[(0,i.jsx)("button",{onClick:d,children:"Cancel (Esc)"}),(0,i.jsx)("button",{className:"danger",onClick:()=>h((e,t,a,i)=>y(e,t,a,i)),children:"Close all"}),(0,i.jsx)("button",{onClick:()=>h((e,t,a,i)=>{let s=function(e,t,a,i,s){if(0===e.legs.length)return e;let l=i.prices[a],r=Math.max(0,(e.expiryIndex-a)/365),n=e.realized,d=[];for(let a of e.legs){var h,u;let e=Math.max(0,Math.min(a.quantity,null!==(h=s[a.id])&&void 0!==h?h:0));if(e>0){let i=m(a,t,l,r);n+=("LONG"===a.side?1:-1)*e*(i-a.entryPrice)}let i=a.quantity-(null!==(u=s[a.id])&&void 0!==u?u:0);i>0&&d.push({...a,quantity:i})}let c={...e,legs:d,realized:n};return 0===c.legs.length&&(c.entryIndex=void 0,c.expiryIndex=void 0),c}(e,t,a,i,M);return f.length>0&&(s=s.expiryIndex?function(e,t,a,i,s){if(void 0===e.expiryIndex)throw Error("openAdditional: no existing expiry to add to");let l=i.prices[a],r=Math.max(0,(e.expiryIndex-a)/365),n=s.map(e=>({id:crypto.randomUUID(),side:e.side,right:e.right,quantity:e.quantity,strike:e.strike,entryPrice:m(e,t,l,r)}));return{...e,legs:[...e.legs,...n]}}(s,t,a,i,f):function(e,t,a,i,s){let l=a+Math.max(1,Math.round(s.expiryDays)),r=i.prices[a],n=(l-a)/365;return{legs:s.legs.map(e=>({id:crypto.randomUUID(),side:e.side,right:e.right,quantity:e.quantity,strike:e.strike,entryPrice:m(e,t,r,n)})),entryIndex:a,expiryIndex:l,realized:e.realized}}(s,t,a,i,{expiryDays:g,legs:f})),s}),children:"Apply changes (same expiry)"})]})]})})}function q(e){let{regime:t,setRegime:a,custom:s,setCustom:l,randomize:r,setRandomize:n,jumps:d,setJumps:h}=e;return(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"Market regime"}),(0,i.jsxs)("div",{className:"row wrap",children:[(0,i.jsxs)("select",{value:t,onChange:e=>a(e.target.value),children:[(0,i.jsx)("option",{value:"BULL",children:"Bullish"}),(0,i.jsx)("option",{value:"NEUTRAL",children:"Neutral"}),(0,i.jsx)("option",{value:"BEAR",children:"Bearish"}),(0,i.jsx)("option",{value:"VOLATILE",children:"Volatile"}),(0,i.jsx)("option",{value:"CUSTOM",children:"Custom"})]}),"CUSTOM"===t&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"μ (annual drift)"}),(0,i.jsx)("input",{type:"number",step:.01,value:s.mu,onChange:e=>l({...s,mu:parseFloat(e.target.value)})})]}),(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"σ (annual vol)"}),(0,i.jsx)("input",{type:"number",step:.01,value:s.sigma,onChange:e=>l({...s,sigma:parseFloat(e.target.value)})})]})]}),(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"Seed"}),(0,i.jsx)("input",{type:"number",value:s.seed,onChange:e=>l({...s,seed:parseInt(e.target.value||"1")})})]}),(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"checkbox",checked:r,onChange:e=>n(e.target.checked)})," Randomize μ & σ"]})]}),(0,i.jsx)("h4",{children:"Jump risk (Merton)"}),(0,i.jsxs)("div",{className:"row wrap",children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"checkbox",checked:d.enabled,onChange:e=>h({...d,enabled:e.target.checked})})," Enable jumps"]}),(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"λ (per year)"}),(0,i.jsx)("input",{type:"number",step:.1,min:0,value:d.lambda,onChange:e=>h({...d,lambda:parseFloat(e.target.value)})})]}),(0,i.jsxs)("label",{className:"field",children:[(0,i.jsxs)("span",{children:["μ",(0,i.jsx)("sub",{children:"J"})," (log)"]}),(0,i.jsx)("input",{type:"number",step:.05,value:d.muJ,onChange:e=>h({...d,muJ:parseFloat(e.target.value)})})]}),(0,i.jsxs)("label",{className:"field",children:[(0,i.jsxs)("span",{children:["σ",(0,i.jsx)("sub",{children:"J"})]}),(0,i.jsx)("input",{type:"number",step:.05,min:0,value:d.sigmaJ,onChange:e=>h({...d,sigmaJ:parseFloat(e.target.value)})})]})]})]})}f.kL.register(f.jn,f.f$,f.od,f.uw,f.u,f.De);let C=[{key:"long_call_atm",label:"Long Call (ATM)",build:e=>[{side:"LONG",right:"CALL",quantity:1,strike:Math.round(e)}]},{key:"bull_call_spread",label:"Bull Call Spread",build:e=>[{side:"LONG",right:"CALL",quantity:1,strike:Math.round(.98*e)},{side:"SHORT",right:"CALL",quantity:1,strike:Math.round(1.05*e)}]},{key:"long_put_atm",label:"Long Put (ATM)",build:e=>[{side:"LONG",right:"PUT",quantity:1,strike:Math.round(e)}]},{key:"bear_put_spread",label:"Bear Put Spread",build:e=>[{side:"LONG",right:"PUT",quantity:1,strike:Math.round(1.02*e)},{side:"SHORT",right:"PUT",quantity:1,strike:Math.round(.95*e)}]},{key:"long_straddle",label:"Long Straddle (ATM)",build:e=>[{side:"LONG",right:"CALL",quantity:1,strike:Math.round(e)},{side:"LONG",right:"PUT",quantity:1,strike:Math.round(e)}]},{key:"short_strangle",label:"Short Strangle (\xb110%)",build:e=>[{side:"SHORT",right:"CALL",quantity:1,strike:Math.round(1.1*e)},{side:"SHORT",right:"PUT",quantity:1,strike:Math.round(.9*e)}]},{key:"iron_condor",label:"Iron Condor (\xb110/20%)",build:e=>[{side:"SHORT",right:"CALL",quantity:1,strike:Math.round(1.1*e)},{side:"LONG",right:"CALL",quantity:1,strike:Math.round(1.2*e)},{side:"SHORT",right:"PUT",quantity:1,strike:Math.round(.9*e)},{side:"LONG",right:"PUT",quantity:1,strike:Math.round(.8*e)}]}];function S(e){let{S:t,T:a,env:l,onPick:r}=e,[n,d]=(0,s.useState)(1234),[h,u]=(0,s.useState)(3e3),o=(0,s.useMemo)(()=>a>0?function(e){var t;let{S0:a,T:i,env:s,seed:l=1234,n:r=3e3}=e,n=(t=0|l,function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}),d=[];for(let e of C){let t=e.build(a),l=t.reduce((e,t)=>e+("LONG"===t.side?1:-1)*t.quantity*c(a,t.strike,s.r,s.q,s.sigma,i,t.right),0),h=[];for(let e=0;e<r;e++){let e=function(e){let t=0,a=0;for(;0===t;)t=e();for(;0===a;)a=e();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*a)}(n),r=a*Math.exp((s.r-s.q-.5*s.sigma*s.sigma)*i+s.sigma*Math.sqrt(i)*e),d=t.reduce((e,t)=>{let a="CALL"===t.right?Math.max(0,r-t.strike):Math.max(0,t.strike-r);return e+("LONG"===t.side?1:-1)*t.quantity*a},0);h.push(d+l)}h.sort((e,t)=>e-t);let u=h.reduce((e,t)=>e+t,0)/r,o=h[Math.floor(r/2)],x=h.filter(e=>e>0).length/r;d.push({key:e.key,label:e.label,premium:l,ev:u,median:o,pop:x})}return d.sort((e,t)=>t.ev-e.ev),d}({S0:t,T:a,env:l,seed:n,n:h}):[],[t,a,l,n,h]);return(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"Learning Mode (beta)"}),(0,i.jsx)("p",{className:"muted",children:"Educational-only. Uses Monte Carlo under risk-neutral drift (r−q), current σ and T."}),(0,i.jsxs)("div",{className:"row wrap",children:[(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"Seed"}),(0,i.jsx)("input",{type:"number",value:n,onChange:e=>d(parseInt(e.target.value||"0"))})]}),(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"Samples"}),(0,i.jsx)("input",{type:"number",value:h,min:500,max:2e4,step:500,onChange:e=>u(parseInt(e.target.value||"1000"))})]})]}),0===o.length?(0,i.jsx)("p",{className:"muted",children:"No T available. Open or set an expiry to evaluate."}):(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Template"}),(0,i.jsx)("th",{children:"Premium"}),(0,i.jsx)("th",{children:"EV"}),(0,i.jsx)("th",{children:"Median"}),(0,i.jsx)("th",{children:"PoP"}),(0,i.jsx)("th",{})]})}),(0,i.jsx)("tbody",{children:o.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.label}),(0,i.jsx)("td",{children:e.premium.toFixed(2)}),(0,i.jsx)("td",{children:(0,i.jsx)("b",{children:e.ev.toFixed(2)})}),(0,i.jsx)("td",{children:e.median.toFixed(2)}),(0,i.jsxs)("td",{children:[(100*e.pop).toFixed(1),"%"]}),(0,i.jsx)("td",{children:(0,i.jsx)("button",{onClick:()=>r(e.key),children:"Use"})})]},e.key))})]})]})}function I(e,t){if(e.length<t)return null;let a=0;for(let i=e.length-t;i<e.length;i++)a+=e[i];return a/t}function O(e){let{S:t,env:a,dates:l,prices:r,jumpsEnabled:n}=e,d=(0,s.useMemo)(()=>{let e=I(r,5),t=I(r,20),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(e.length<t+1)return null;let a=[];for(let i=e.length-t;i<e.length;i++){let t=Math.log(e[i]/e[i-1]);a.push(t)}return Math.sqrt(a.reduce((e,t)=>e+t*t,0)/Math.max(1,a.length-1))*Math.sqrt(252)}(r,20),s=a.sigma,l=[],d="";if(e&&t){let a=e>1.002*t,r=e<.998*t;a&&s<(null!=i?i:s)*.9?(d="Bull Call Spread or Long Call",l.push("Uptrend with relatively low IV vs RV favors debit bullish strategies with convexity.")):r&&s<(null!=i?i:s)*1.1?(d="Bear Put Spread or Long Put",l.push("Downtrend with modest IV: defined-risk bearish plays.")):a||r||!(s>(null!=i?i:s)*1.3)?(d="Long Straddle/Strangle (if IV low) or Wait",l.push("Signal unclear: consider convexity if IV is cheap or wait for clarity.")):(d="Iron Condor or Short Strangle (beware margin)",l.push("Sideways + high IV: short premium/defined risk spreads capture theta."))}else d="Gather more data",l.push("Not enough history yet to infer trend.");return n&&l.push("Jump risk ON → prefer **defined-risk** structures (spreads) over naked shorts."),{rec:d,rationale:l}},[t,a,l,r,n]);return(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"Coach (when/why)"}),(0,i.jsxs)("p",{children:[(0,i.jsx)("b",{children:"Suggestion:"})," ",d.rec]}),(0,i.jsx)("ul",{children:d.rationale.map((e,t)=>(0,i.jsx)("li",{className:"muted",children:e},t))})]})}var w=a(1013);function T(){let[e,t]=(0,s.useState)({r:.03,q:0,sigma:.25}),[a,l]=(0,s.useState)("BULL"),[d,h]=(0,s.useState)(!0),[u,m]=(0,s.useState)({mu:.05,sigma:.25,seed:11}),[j,b]=(0,s.useState)({enabled:!1,lambda:2,muJ:-.2,sigmaJ:.25}),f="CUSTOM"===a?{key:"CUSTOM",label:"Custom",baseMu:u.mu,baseSigma:u.sigma}:n[a],[M,L]=(0,s.useState)(()=>r({S0:100,regime:f,days:420,seed:u.seed,randomize:d,jumps:j})),[I,T]=(0,s.useState)(30),[A,P]=(0,s.useState)(x()),[U,E]=(0,s.useState)(!1),[z,F]=(0,s.useState)(null),[D,R]=(0,s.useState)({startingCash:1e4,cash:1e4}),[G,_]=(0,s.useState)([{day:0,realized:0}]);(0,s.useEffect)(()=>{L(r({S0:100,regime:f,days:420,seed:u.seed,randomize:d,jumps:j})),T(30),P(x()),_([{day:0,realized:0}]),F(null),t(e=>({...e,sigma:f.baseSigma}))},[a,u.mu,u.sigma,u.seed,d,j.enabled,j.lambda,j.muJ,j.sigmaJ]);let J=M.prices[I],B=M.dates[I],V=A.expiryIndex?Math.max(0,A.expiryIndex-I):void 0;(0,s.useEffect)(()=>{if(void 0!==A.expiryIndex&&I>=A.expiryIndex&&A.legs.length>0){let t=Math.max(0,(A.expiryIndex-I)/365),a=A.legs.map(e=>({side:e.side,right:e.right,quantity:e.quantity,price:J&&void 0!==t?"CALL"===e.right?Math.max(0,J-e.strike):Math.max(0,e.strike-J):0})).reduce((e,t)=>e+("LONG"===t.side?1:-1)*t.quantity*t.price,0),i=y(A,e,I,M);i.realized!==A.realized&&_(e=>[...e,{day:I,realized:i.realized}]),R(e=>({...e,cash:e.cash+a})),P(i)}},[I,A.expiryIndex]);let H=(0,s.useMemo)(()=>{let e=M.dates.slice(0,I+1),t=new Date(M.dates[I]);for(let a=1;a<=30;a++){let i=new Date(t);i.setDate(t.getDate()+a),e.push(i.toISOString().slice(0,10))}return e},[M.dates,I]),Q=(0,s.useMemo)(()=>{let e=M.prices.slice(0,I+1);for(let t=0;t<30;t++)e.push(null);return e},[M.prices,I]),W=(0,s.useMemo)(()=>(function(e,t,a,i){if(!e.entryIndex||0===e.legs.length)return Array(a+1).fill(0);let s=e.entryIndex,l=Array(a+1).fill(0);for(let r=s;r<=a;r++){let a=i.prices[r],s=Math.max(0,(e.expiryIndex-r)/365),n=e.legs.reduce((e,i)=>e+g(t,a,s,i),0),d=e.legs.reduce((e,t)=>e+p(t.side)*t.quantity*t.entryPrice,0);l[r]=e.realized+(n-d)}for(let e=0;e<s;e++)l[e]=0;return l})(A,e,I,M),[A,e,I,M]),$=(0,s.useMemo)(()=>{let e=[],t=0,a=0;for(let i=0;i<H.length;i++){let s=Math.min(i,I);for(;a<G.length&&G[a].day<=s;)t=G[a].realized,a++;e.push(i<=I?t:null)}return e},[H,I,G]),K=(0,s.useMemo)(()=>{let e=W.slice(0,I+1);for(let t=0;t<30;t++)e.push(null);return e},[W,I]),X=(0,s.useMemo)(()=>(function(e,t,a,i){if(0===e.legs.length)return{value:0,cost:0,unrealized:0,realized:e.realized};let s=i.prices[a],l=Math.max(0,(e.expiryIndex-a)/365),r=e.legs.reduce((e,a)=>e+g(t,s,l,a),0),n=e.legs.reduce((e,t)=>e+p(t.side)*t.quantity*t.entryPrice,0);return{value:r,cost:n,unrealized:r-n,realized:e.realized}})(A,e,I,M),[A,e,I,M]),Y=D.cash+X.value,Z=(0,s.useMemo)(()=>(function(e,t){let a=0;for(let i of e.legs)if("SHORT"===i.side){let e=i.entryPrice,s="CALL"===i.right?Math.max(0,t-i.strike):Math.max(0,i.strike-t);a+=(Math.max(.2*t-s,.1*t)+e)*i.quantity}return Math.max(0,a)})(A,J),[A,J]),ee=function(e,t,a,i){let s=i.prices[a],l=Math.max(0,(e.expiryIndex?e.expiryIndex-a:0)/365);return e.legs.reduce((e,a)=>{let i=o(s,a.strike,t.r,t.q,t.sigma,Math.max(1e-8,l),a.right);return e.delta+=p(a.side)*a.quantity*i.delta,e.gamma+=p(a.side)*a.quantity*i.gamma,e.vega+=p(a.side)*a.quantity*i.vega,e.theta+=p(a.side)*a.quantity*i.theta,e},{delta:0,gamma:0,vega:0,theta:0})}(A,e,I,M),et=function(e,t,a,i){var s;let l=null!==(s=e.entryIndex)&&void 0!==s?s:a,r={delta:[],theta:[],vega:[],gamma:[],idxStart:l};for(let s=0;s<=a;s++){if(!e.entryIndex||s<l){r.delta.push(0),r.theta.push(0),r.vega.push(0),r.gamma.push(0);continue}let a=i.prices[s],n=Math.max(0,(e.expiryIndex-s)/365),d=e.legs.reduce((e,i)=>{let s=o(a,i.strike,t.r,t.q,t.sigma,Math.max(1e-8,n),i.right);return e.delta+=p(i.side)*i.quantity*s.delta,e.gamma+=p(i.side)*i.quantity*s.gamma,e.vega+=p(i.side)*i.quantity*s.vega,e.theta+=p(i.side)*i.quantity*s.theta,e},{delta:0,gamma:0,vega:0,theta:0});r.delta.push(d.delta),r.theta.push(d.theta),r.vega.push(d.vega),r.gamma.push(d.gamma)}return r}(A,e,I,M),ea=(0,s.useMemo)(()=>{if(!A.expiryIndex||0===A.legs.length)return[];let t=Math.max(0,A.expiryIndex-I),a=[0,1,5,10,20,30,60].filter(e=>e<=t),i=[],[s,l]=function(e,t){if(!e.entryIndex||0===e.legs.length)return[[],[]];let a=e.legs.reduce((e,t)=>e+("LONG"===t.side?-1:1)*t.quantity*t.entryPrice,0),i=Math.max(.1,.7*t),s=1.3*t,l=[],r=[];for(let t=0;t<=200;t++){let n=i+t/200*(s-i),d=e.legs.reduce((e,t)=>{let a="CALL"===t.right?Math.max(0,n-t.strike):Math.max(0,t.strike-n);return e+("LONG"===t.side?1:-1)*t.quantity*a},0);l.push(n),r.push(d+a)}return[l,r]}(A,J);for(let t of(i.push({label:"Expiry",prices:s,values:l}),a)){if(0===t)continue;let[a,s]=function(e,t,a,i){if(!e.entryIndex||0===e.legs.length)return[[],[]];let s=e.legs.reduce((e,t)=>e+("LONG"===t.side?-1:1)*t.quantity*t.entryPrice,0),l=Math.max(.1,.7*a),r=1.3*a,n=[],d=[];for(let a=0;a<=200;a++){let h=l+a/200*(r-l),u=e.legs.reduce((e,a)=>{let s=c(h,a.strike,t.r,t.q,t.sigma,Math.max(0,i),a.right);return e+("LONG"===a.side?1:-1)*a.quantity*s},0);n.push(h),d.push(u+s)}return[n,d]}(A,e,J,t/365);i.push({label:"".concat(t,"d before"),prices:a,values:s})}return i},[A,e,I,J]),ei=()=>T(e=>Math.min(M.prices.length-31,e+1));return(0,s.useEffect)(()=>{let e=e=>{("n"===e.key||"N"===e.key||"ArrowRight"===e.key)&&(e.preventDefault(),ei()),("a"===e.key||"A"===e.key)&&(e.preventDefault(),E(!0)),("c"===e.key||"C"===e.key)&&(e.preventDefault(),P(x())),"Escape"===e.key&&(E(!1),F(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[I]),(0,i.jsxs)("div",{className:"grid2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"h1",children:"Options Timeline Simulator"}),(0,i.jsx)(q,{regime:f.key,setRegime:l,custom:u,setCustom:m,randomize:d,setRandomize:h,jumps:j,setJumps:b}),(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsxs)("div",{className:"row wrap",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Day:"})," ",I]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Date:"})," ",B]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Spot S:"})," ",J.toFixed(2)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"r:"})," ",e.r.toFixed(3)," | ",(0,i.jsx)("b",{children:"q:"})," ",e.q.toFixed(3)," | ",(0,i.jsx)("b",{children:"σ:"})," ",e.sigma.toFixed(2)]}),void 0!==V&&(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"DTE:"})," ",V," day(s)"]})]}),(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("button",{onClick:ei,children:"Next day ▶ (N)"}),(0,i.jsx)("button",{onClick:()=>E(!0),children:"Take action (A)"})]}),(0,i.jsx)("p",{className:"muted",children:"Shortcuts: N/→ next, A action, Esc close dialog."})]}),(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"Account"}),(0,i.jsxs)("div",{className:"row wrap",children:[(0,i.jsxs)("label",{className:"field",children:[(0,i.jsx)("span",{children:"Initial deposit (€)"}),(0,i.jsx)("input",{type:"number",value:D.startingCash,onChange:e=>{let t=parseFloat(e.target.value||"0");R(e=>({...e,startingCash:t,cash:t-(e.startingCash-e.cash)}))}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Cash:"})," € ",D.cash.toFixed(2)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Position value:"})," € ",X.value.toFixed(2)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Equity:"})," € ",Y.toFixed(2)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Margin req:"})," € ",Z.toFixed(2)," (",(100*(Y>0?Z/Y:0)).toFixed(0),"%)"]})]})]}),(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"Price history (+30 days ahead)"}),(0,i.jsx)(v,{labels:H,datasets:[{label:"Price",data:Q,color:"#22c55e"}]})]}),(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"P/L (Realized vs Total)"}),(0,i.jsx)(v,{labels:H,datasets:[{label:"Realized",data:$,color:"#22c55e"},{label:"Total (Realized + Unrealized)",data:K,color:"#eab308"}]})]}),(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"Greeks timeline"}),(0,i.jsx)(v,{labels:H,datasets:[{label:"Δ (Delta)",data:et.delta.concat(Array(Math.max(0,H.length-et.delta.length)).fill(null)),color:"#60a5fa"},{label:"Θ (Theta/yr)",data:et.theta.concat(Array(Math.max(0,H.length-et.theta.length)).fill(null)),color:"#f97316"},{label:"Vega",data:et.vega.concat(Array(Math.max(0,H.length-et.vega.length)).fill(null)),color:"#22c55e"}]})]}),(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"Payoff slices (expiry & selected days before expiry)"}),0===ea.length?(0,i.jsx)("p",{className:"muted",children:"No open position"}):(0,i.jsx)(k,{series:ea})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("section",{className:"panel",children:[(0,i.jsx)("h3",{children:"Open position"}),0===A.legs.length?(0,i.jsx)("p",{className:"muted",children:"No open legs"}):(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Side"}),(0,i.jsx)("th",{children:"Right"}),(0,i.jsx)("th",{children:"Qty"}),(0,i.jsx)("th",{children:"Strike"}),(0,i.jsx)("th",{children:"Expiry (abs day)"}),(0,i.jsx)("th",{children:"DTE"}),(0,i.jsx)("th",{children:"Entry px"})]})}),(0,i.jsx)("tbody",{children:A.legs.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.side}),(0,i.jsx)("td",{children:e.right}),(0,i.jsx)("td",{children:e.quantity}),(0,i.jsx)("td",{children:e.strike}),(0,i.jsx)("td",{children:A.expiryIndex}),(0,i.jsx)("td",{children:null!=V?V:"-"}),(0,i.jsx)("td",{children:e.entryPrice.toFixed(2)})]},e.id))})]}),(0,i.jsxs)("div",{className:"row wrap",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Δ:"})," ",ee.delta.toFixed(3)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Γ:"})," ",ee.gamma.toFixed(5)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Θ (per year):"})," ",ee.theta.toFixed(2)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Vega:"})," ",ee.vega.toFixed(2)]})]})]}),(0,i.jsx)(S,{S:J,T:(null!=V?V:0)/365,env:e,onPick:function(e){let t=C.find(t=>t.key===e);t&&(F({legs:t.build(J),expiryDays:(null!=V?V:30)||30}),E(!0))}}),(0,i.jsx)(O,{S:J,env:e,dates:M.dates.slice(0,I+1),prices:M.prices.slice(0,I+1),jumpsEnabled:j.enabled})]}),(0,i.jsx)("div",{children:(0,i.jsx)(w.z,{})}),U&&(0,i.jsx)(N,{env:e,currentIndex:I,position:A,onClose:()=>{E(!1),F(null)},onSubmit:t=>{E(!1),function(t){let a=t(A,e,I,M),i=0,s=A.legs.filter(e=>!a.legs.find(t=>t.id===e.id));if(s.length>0){let t=Math.max(0,(A.expiryIndex-I)/365),a=s.map(a=>({side:a.side,right:a.right,quantity:a.quantity,price:c(J,a.strike,e.r,e.q,e.sigma,t,a.right)}));i+=a.reduce((e,t)=>e+("LONG"===t.side?1:-1)*t.quantity*t.price,0)}let l=a.legs.filter(e=>!A.legs.find(t=>t.id===e.id));if(l.length>0){a.expiryIndex;let e=l.map(e=>({side:e.side,right:e.right,quantity:e.quantity,price:e.entryPrice}));i+=e.reduce((e,t)=>e+("LONG"===t.side?-1:1)*t.quantity*t.price,0)}R(e=>({...e,cash:e.cash+i})),a.realized!==A.realized&&_(e=>[...e,{day:I,realized:a.realized}]),P(a)}(t),F(null)},hist:M,preset:z})]})}}},function(e){e.O(0,[674,746,13,971,23,744],function(){return e(e.s=7207)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36],{9727:function(e,t,s){Promise.resolve().then(s.bind(s,4163))},4163:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var i=s(7437),r=s(2265);function l(){return Date.now()}function a(e){return"${prefix}_${Math.random().toString(36).slice(2, 10)}"}function n(e,t){return e.positions[t]||(e.positions[t]={symbol:t,lots:[],totalShares:0,avgCost:0,reservedShares:0}),e.positions[t]}function o(e,t){e.ledger.push(t)}function c(e){let t=e.lots.reduce((e,t)=>e+t.shares,0),s=e.lots.reduce((e,t)=>e+t.shares*t.costBasis,0);e.totalShares=t,e.avgCost=t>0?s/t:0}class d{setPrice(e,t){this.prices[e]=t}getUnrealizedRows(){return function(e,t){let s=[];for(let[r,l]of Object.entries(e.positions)){var i;let e=null!==(i=t[r])&&void 0!==i?i:0,a=(e-l.avgCost)*l.totalShares;s.push({symbol:r,shares:l.totalShares,avgCost:l.avgCost,price:e,unrealized:a})}return s}(this.pf,this.prices)}constructor(e=1e5,t="USD"){this.prices={},this.currency="USD",this.currency=t,this.pf=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";return{timestamp:l(),cash:{currency:t,available:e,reserved:0},positions:{},ledger:[]}}(e,t)}}let h=new d(5e4,"USD");function p(e){return e.ledger.reduce((e,t)=>e+(t.realizedPnL||0),0)}function u(){let[e,t]=(0,r.useState)([]),[s,d]=(0,r.useState)(h.pf.cash.available),[u,f]=(0,r.useState)(h.pf.cash.reserved),[g,x]=(0,r.useState)(p(h.pf)),[v,j]=(0,r.useState)("XYZ"),[y,m]=(0,r.useState)(100),[S,b]=(0,r.useState)(100),C=()=>{t(h.getUnrealizedRows()),d(h.pf.cash.available),f(h.pf.cash.reserved),x(p(h.pf))};return(0,r.useEffect)(()=>{C();let e=setInterval(C,500);return()=>clearInterval(e)},[]),(0,i.jsxs)("div",{style:{border:"1px solid #ccc",padding:"10px",borderRadius:8,fontFamily:"system-ui",background:"#fafafa"},children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"Portfolio & P&L"}),(0,i.jsxs)("div",{style:{display:"flex",gap:24},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Cash available:"})," ",s.toFixed(2)," ",h.currency]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Cash reserved:"})," ",u.toFixed(2)," ",h.currency]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Realized P&L:"})," ",g.toFixed(2)," ",h.currency]})]}),(0,i.jsx)("div",{style:{marginLeft:"auto"},children:(0,i.jsx)("button",{onClick:()=>{let e=new Blob([[["id","timestamp","type","symbol","cashDelta","realizedPnL","details"],...h.pf.ledger.map(e=>[e.id,e.timestamp,e.type,e.symbol||"",e.cashDelta,e.realizedPnL,JSON.stringify(e.details)])].map(e=>e.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="portfolio-ledger.csv",s.click(),URL.revokeObjectURL(t)},children:"Export ledger CSV"})})]}),(0,i.jsx)("hr",{}),(0,i.jsx)("h4",{children:"Underlying positions"}),(0,i.jsxs)("table",{style:{width:"100%"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{align:"left",children:"Symbol"}),(0,i.jsx)("th",{align:"right",children:"Shares"}),(0,i.jsx)("th",{align:"right",children:"Avg cost"}),(0,i.jsx)("th",{align:"right",children:"Last price"}),(0,i.jsx)("th",{align:"right",children:"Unrealized"})]})}),(0,i.jsxs)("tbody",{children:[e.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.symbol}),(0,i.jsx)("td",{align:"right",children:e.shares}),(0,i.jsx)("td",{align:"right",children:e.avgCost.toFixed(2)}),(0,i.jsx)("td",{align:"right",children:e.price.toFixed(2)}),(0,i.jsx)("td",{align:"right",style:{color:e.unrealized>=0?"green":"crimson"},children:e.unrealized.toFixed(2)})]},e.symbol)),0===e.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:5,style:{opacity:.7},children:"No underlying positions yet."})})]})]}),(0,i.jsx)("hr",{}),(0,i.jsx)("h4",{children:"Quick underlying trade"}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("input",{value:v,onChange:e=>j(e.target.value.toUpperCase()),placeholder:"Symbol",style:{width:80}}),(0,i.jsx)("input",{type:"number",value:y,onChange:e=>m(parseInt(e.target.value,10)||0),placeholder:"Shares",style:{width:100}}),(0,i.jsx)("input",{type:"number",value:S,onChange:e=>b(parseFloat(e.target.value)||0),placeholder:"Price",style:{width:100}}),(0,i.jsx)("button",{onClick:()=>{(function(e,t,s,i){var r,d;let h=s*i.price;if(e.cash.available<h)throw Error("Insufficient cash: need ${cost.toFixed(2)}, have ${state.cash.available.toFixed(2)}");e.cash.available-=h;let p={lotId:a("lot"),symbol:t,shares:s,costBasis:i.price,openedAt:null!==(r=i.timestamp)&&void 0!==r?r:l()},u=n(e,t);u.lots.push(p),c(u),o(e,{id:a("led"),timestamp:null!==(d=i.timestamp)&&void 0!==d?d:l(),type:"BUY_STOCK",symbol:t,details:{shares:s,price:i.price},cashDelta:-(s*i.price),realizedPnL:0})})(h.pf,v,y,{price:S}),h.setPrice(v,S),C()},children:"Buy"}),(0,i.jsx)("button",{onClick:()=>{(function(e,t,s,i){var r;let d=n(e,t);if(s>d.totalShares-d.reservedShares)throw Error("Insufficient free shares: ${pos.totalShares - pos.reservedShares}");let h=s,p=0;for(;h>0;){let e=d.lots[0];if(!e)throw Error("Missing lot");let t=Math.min(h,e.shares);p+=t*(i.price-e.costBasis),e.shares-=t,0===e.shares&&d.lots.shift(),h-=t}let u=s*i.price;e.cash.available+=u,c(d),o(e,{id:a("led"),timestamp:null!==(r=i.timestamp)&&void 0!==r?r:l(),type:"SELL_STOCK",symbol:t,details:{shares:s,price:i.price},cashDelta:+u,realizedPnL:p})})(h.pf,v,y,{price:S}),h.setPrice(v,S),C()},children:"Sell"})]}),(0,i.jsx)("div",{style:{opacity:.7,fontSize:12,marginTop:6},children:"No fees/slippage; educational paper-trading model."})]})}function f(){return(0,i.jsx)("div",{style:{padding:16},children:(0,i.jsx)(u,{})})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=9727)}),_N_E=e.O()}]);